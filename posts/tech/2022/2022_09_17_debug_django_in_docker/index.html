<!doctype html><html><head><title>Debugging Django in a Docker container</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link rel=stylesheet href=/css/flag-icon.min.css><link rel=stylesheet href=/google-fonts/Mulish/mulish.css><link rel=stylesheet href=/fontawesome/css/all.min.css><link rel=icon type=image/png href=/images/mjn-logo_huc94cd2164fb0a8cc0029e94778229d7b_288620_42x0_resize_box_3.png><meta property="og:title" content="Debugging Django in a Docker container"><meta property="og:description" content="2 methods for debugging a Django application running in a Docker container"><meta property="og:type" content="article"><meta property="og:url" content="https://michjnich.github.io/posts/tech/2022/2022_09_17_debug_django_in_docker/"><meta property="og:image" content="https://michjnich.github.io/posts/tech/2022/2022_09_17_debug_django_in_docker/images/bugs_512x256.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-18T09:00:00+02:00"><meta property="article:modified_time" content="2022-09-18T09:00:00+02:00"><meta name=description content="2 methods for debugging a Django application running in a Docker container"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css><link rel=stylesheet href=/css/style.css><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://michjnich.github.io/posts/tech/2022/2022_09_17_debug_django_in_docker/images/bugs_512x256.png"><meta name=twitter:title content="Debugging Django in a Docker container"><meta name=twitter:description content="2 methods for debugging a Django application running in a Docker container"></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/><img src=/images/mjn-logo.svg alt=Logo>
Michael J. Nicholson</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"></ul></div></div><img src=/images/mjn-logo.svg class=d-none id=main-logo alt=Logo>
<img src=/images/mjn-logo_huc94cd2164fb0a8cc0029e94778229d7b_288620_42x0_resize_box_3.png class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/tech/>Tech</a><ul class=active><li><i class="fas fa-plus-circle"></i><a href=/posts/tech/2023/>2023</a><ul><li><a href=/posts/tech/2023/scheduling-backups-gitlab-ci-cd/ title="Backup with GitLab CI/CD">Backup with GitLab CI/CD</a></li><li><a href=/posts/tech/2023/try-except-else-finally/ title="Measuring developer productivity">Measuring developer productivity</a></li><li><a href=/posts/tech/2023/try-except-else-finally/ title=try...except...else...finally>try...except...else...finally</a></li></ul></li><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/tech/2022/>2022</a><ul class=active><li><a class=active href=/posts/tech/2022/2022_09_17_debug_django_in_docker/ title="Debug Django in Docker">Debug Django in Docker</a></li><li><a href=/posts/tech/2022/2022_04_06_duckduckgo_bangs/ title="DuckDuckGo !bangs">DuckDuckGo !bangs</a></li><li><a href=/posts/tech/2022/2022_12_08_email_inbox_for_django_development/ title="Email inbox for Django">Email inbox for Django</a></li><li><a href=/posts/tech/2022/2022_09_21_colourblind_settings_for_git/ title="Git for the colourblind">Git for the colourblind</a></li><li><a href=/posts/tech/2022/2022_04_03_welcome_to_v2/ title="michjnich.com v2">michjnich.com v2</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/tech/2021/>2021</a><ul><li><a href=/posts/tech/2021/2021_02_25_remote_working/ title="Remote working">Remote working</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/tech/2020/>2020</a><ul><li><a href=/posts/tech/2020/2020_12_23_legacy_monolith/ title="Legacy monolith">Legacy monolith</a></li></ul></li></ul></li><li><a href=/posts/writing/ title=Writing>Writing</a></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/posts/tech/2022/2022_09_17_debug_django_in_docker/images/bugs.png)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/michjnich_hu196abb93d882ab659dc50e489200e798_20228_120x120_fit_q75_box.jpg alt="Author Image"><h5 class=author-name>Michael J. Nicholson</h5><p>Sunday, September 18, 2022</p></div><div class=title><h1>Debugging Django in a Docker container</h1></div><div class=post-content id=post-content><p>Have you ever tried hunting for a bug in a Django app that&rsquo;s running in a Docker container? It&rsquo;s not always a trivial process and can have you dotting print statements all over the place because you can&rsquo;t figure out how to use breakpoints properly inside the Docker container.</p><p>Well, fortunately there is a solution to this. 2 solutions even.</p><h2 id=solution-1-configure-vs-code-to-debug-a-dockerised-app>Solution 1: Configure VS Code to debug a dockerised app</h2><h3 id=step-1---configure-vs-code>Step 1 - Configure VS Code</h3><p><a href=https://code.visualstudio.com/Docs/editor/debugging>VS Code has built in debugging support</a> for a variety of languages. For local files and scripts this is fairly simple - you can press <code>F5</code> and VS Code will try and run the currently active file.</p><p>Of course, Django is a little more complex than this, and for this scenario VS Code provides the ability to define and save a debug configuration. This is done through the use of a JSON file called <code>launch.json</code>. You can create one yourself (it is simply a JSON file, after all), or select the debug icon (the &lsquo;play&rsquo; symbol with the little bug on it on the left toolbar) and you will be given the option to create a <code>launch.json</code> file.</p><p><img src=images/run-and-debug.png alt="Run and debug menu option"></p><p>Most likely VS Code will then identify your project as a Django app, or at the very least, a Python one, but you can largely ignore this and copy/paste the following configuration.</p><pre tabindex=0><code>{
    &#34;version&#34;: &#34;0.2.0&#34;,
    &#34;configurations&#34;: [
        {
            &#34;name&#34;: &#34;Django - Debug&#34;,
            &#34;type&#34;: &#34;python&#34;,
            &#34;request&#34;: &#34;attach&#34;,
            &#34;pathMappings&#34;: [
                {
                    &#34;localRoot&#34;: &#34;${workspaceFolder}/src&#34;,
                    &#34;remoteRoot&#34;: &#34;/&lt;app folder in container&gt;&#34;
                }
            ],
            &#34;port&#34;: 3000,
            &#34;host&#34;: &#34;127.0.0.1&#34;,
        }
    ]
}
</code></pre><p>Some of this should be fairly self-explanatory.</p><ul><li><code>name</code> is unimportant and just needs to be something meaningful to you.</li><li><code>type</code> as we can see is <code>python</code>.</li><li><code>request</code> can be one of 2 values - <code>launch</code> or <code>attach</code>. In our case we are going to attach to a running container.</li><li><code>localRoot</code> is the path of your application in the local environment. <code>${workspaceFolder}</code> is the VS Code value for the root of your project. <code>src</code> is a common location to put the actual application code (things like <code>Dockerfile</code>, <code>requirements.txt</code> etc. being in the root itself). Your project may have a differntly named folder here (<code>app</code> is common, as is the project name itself), so change this accordingly.</li><li><code>remoteRoot</code> is the name of the application folder in the container. This will be defined in your <code>Dockerfile</code>, but follow most tutorials or instructions and you will likely end up with it called <code>app</code>. Make sure the value is correct for the settings in your own <code>Dockerfile</code>.</li><li><code>port</code> is the port VS Code will use to connect to the container for debugging. The port number is unimportant, as long as it does not clash with the port your application is using (which in most cases means don&rsquo;t use port <code>8000</code> for Django apps).</li><li><code>host</code> will simply be your localhost IP.</li></ul><h3 id=step-2---configure-your-project>Step 2 - Configure your project</h3><p>Now that VS Code is configured, we need to tell your Django project that it&rsquo;s going to be looking for debug information on a specific port. The easiest way to do this is to use the <a href=https://github.com/microsoft/debugpy/>debugpy</a> package. This will need installing into your Docker container when building for development, but should not be used when deploying to production (I will write a post another time on using multiple <code>Dockerfile</code>s and multi-stage builds).</p><p>Once you have ensured <code>debugpy</code> will be installed, make the following changes to your <code>manage.py</code> file for the project.</p><pre tabindex=0><code>def main():
    os.environ.setdefault(&#34;DJANGO_SETTINGS_MODULE&#34;, &#34;config.settings&#34;)

	  if settings.DEBUG:
        if os.environ.get(&#34;RUN_MAIN&#34;) or os.environ.get(&#34;WERKZEUG_RUN_MAIN&#34;):
            import debugpy
  
            debugpy.listen((&#34;0.0.0.0&#34;, 3000))
            print(&#34;Press F5 in VS Code to attach debugger...&#34;, flush=True)
            debugpy.wait_for_client()
            print(&#34;VS Code debugger attached...&#34;, flush=True)
</code></pre><p>This will check the <code>DEBUG</code> flag (which should only ever be set in a development environment, and never in production!), and if it is set, import <code>debugpy</code> to allow VS Code to connect to the project.</p><ul><li><code>debugpy.listen(("0.0.0.0", 3000))</code> listens on port <code>3000</code> for communication from VS code (if you chose a different port number in your <code>launch.json</code> you should use that here).</li><li>The <code>Press F5</code> print statement will just tell you when to go to your project in VS Code and hit <code>F5</code> to connect it to the container (which can only be done once <code>debugpy</code> is listening).</li><li><code>debugpy.wait_for_client()</code> then waits for information from VS Code on port <code>3000</code>.</li></ul><h3 id=step-3---debug-your-project>Step 3 - Debug your project</h3><p>Start your project up using Docker as usual in a shell. You will see something like this:</p><pre tabindex=0><code>Recreating myproject-db-1 ... done
Recreating myproject_myproject_1 ... done
Attaching to myproject_db_1, myproject_myproject_1
db_1            |
db_1            | PostgreSQL Database directory appears to contain a database; Skipping initialization
db_1            |
db_1            | 2022-09-17 16:26:02.975 UTC [1] LOG:  starting PostgreSQL 13.8 (Debian 13.8-1.pgdg110+1) on x86_64-pc-linux-gnu, compiled by gcc (Debian 10.2.1-6) 10.2.1 20210110, 64-bit
db_1            | 2022-09-17 16:26:02.977 UTC [1] LOG:  listening on IPv4 address &#34;0.0.0.0&#34;, port 5432
db_1            | 2022-09-17 16:26:02.977 UTC [1] LOG:  listening on IPv6 address &#34;::&#34;, port 5432
db_1            | 2022-09-17 16:26:02.998 UTC [1] LOG:  listening on Unix socket &#34;/var/run/postgresql/.s.PGSQL.5432&#34;
db_1            | 2022-09-17 16:26:03.020 UTC [26] LOG:  database system was shut down at 2022-09-17 15:22:33 UTC
db_1            | 2022-09-17 16:26:03.039 UTC [1] LOG:  database system is ready to accept connections
myproject_1     | Press F5 in VS Code to attach debugger...
</code></pre><p>Go to VS Code and hit <code>F5</code>. You should then see similar logs in both the <code>Debug console</code> in VS Code, and the docker logs.</p><pre tabindex=0><code>VS Code debugger attached...
2022-09-17 16:29:13 [7] [INFO] pathname=/usr/local/lib/python3.10/site-packages/django/utils/autoreload.py lineno=637 funcname=run_with_reloader Watching for file changes with StatReloader
Performing system checks...

System check identified no issues (0 silenced).

September 17, 2022 - 16:29:14
Django version 3.2.15, using settings &#39;config.settings&#39;
Starting development server at http://0.0.0.0:8000/
Quit the server with CONTROL-C.
</code></pre><p>You can now use the VS Code debugger as you would normally, complete with breakpoints that will drop you into a <code>pdb</code> shell in the debug console and let you interrogate the state at ant given point in your code.</p><hr><h2 id=solution-2-running-the-server-in-the-container-manually>Solution 2: Running the server in the container manually</h2><p>This solution uses simple <code>docker-compose</code> commands to let you start your container manually and run the server, rather than starting it with <code>docker compose up</code> along with all the other services.</p><h3 id=step-1---run-all-the-backing-services>Step 1 - Run all the backing services</h3><p>Your project likely depends on other services other than your actual application: almost certainly a database, possibly redis, elasticsearch etc. Start these services first so they are running correctly. You can do this as usual using</p><pre tabindex=0><code>docker compose up [-d] &lt;service1&gt; &lt;service2&gt; ... &lt;serviceN&gt;
</code></pre><p>At this point do <em>NOT</em> start your main application.</p><h3 id=step-2---start-your-application>Step 2 - Start your application</h3><p>This needs to be started using <code>run</code>, not <code>up</code>. Use the following command:</p><pre tabindex=0><code>docker compose run --service-ports -it &lt;container name&gt; bash
</code></pre><p>This will start your application container, but in a bash shell.</p><blockquote><p><strong>Note:</strong></p><p>If this doesn&rsquo;t work properly, and your container starts, it is likely becuase you are using <code>ENTRYPOINT</code>. It is advisable to use <code>RUN</code> instead as this can be overridden by you when you want to shell into the container.</p></blockquote><h3 id=step-3---start-your-local-server>Step 3 - Start your local server</h3><p>You should now be in your application container in a shell. Now you can simply run the server as usual. So for Django, this would be:</p><pre tabindex=0><code>python manage.py runserver [&lt;IP&gt;:&lt;port&gt;]
</code></pre><blockquote><p><strong>Note:</strong></p><p>Do not run the server using <code>gunicorn</code>, <code>uwsgi</code> or any other server as these do not attach <code>STDIN</code> and so will not work with <code>breakpoint</code>, <code>pdb</code> etc.</p></blockquote><hr><p>And that&rsquo;s it - 2 ways to help you debug your application while it&rsquo;s running in a docker container.</p><p>Happy debugging!</p></div><div class="row pl-3 pr-3"><div class="col-md-6 share-buttons"></div></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/tech/2023/try-except-else-finally/ title=try...except...else...finally class="btn btn-outline-info"><div><i class="fas fa-chevron-circle-left"></i> Prev</div><div class=next-prev-text>try...except...else...finally</div></a></div><div class="col-md-6 next-article"><a href=/posts/tech/2022/2022_04_06_duckduckgo_bangs/ title="Power-up your DuckDuckGo searches with !bangs" class="btn btn-outline-info"><div>Next <i class="fas fa-chevron-circle-right"></i></div><div class=next-prev-text>Power-up your DuckDuckGo searches with !bangs</div></a></div></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#solution-1-configure-vs-code-to-debug-a-dockerised-app>Solution 1: Configure VS Code to debug a dockerised app</a><ul><li><a href=#step-1---configure-vs-code>Step 1 - Configure VS Code</a></li><li><a href=#step-2---configure-your-project>Step 2 - Configure your project</a></li><li><a href=#step-3---debug-your-project>Step 3 - Debug your project</a></li></ul></li><li><a href=#solution-2-running-the-server-in-the-container-manually>Solution 2: Running the server in the container manually</a><ul><li><a href=#step-1---run-all-the-backing-services>Step 1 - Run all the backing services</a></li><li><a href=#step-2---start-your-application>Step 2 - Start your application</a></li><li><a href=#step-3---start-your-local-server>Step 3 - Start your local server</a></li></ul></li></ul></nav></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://michjnich.github.io#about>About</a></li><li class=nav-item><a class=smooth-scroll href=https://michjnich.github.io#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=https://michjnich.github.io#experiences>Experience</a></li><li class=nav-item><a class=smooth-scroll href=https://michjnich.github.io#projects>Projects</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:michjnich.com@outlook.com target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>michjnich.com@outlook.com</span></a></li></ul></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hossainemruz/toha target=_blank rel=noopener><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2022 Copyright, Michael J. Nicholson</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script type=text/javascript src=/js/jquery-3.4.1.min.js></script>
<script type=text/javascript src=/js/popper.min.js></script>
<script type=text/javascript src=/js/bootstrap.min.js></script>
<script type=text/javascript src=/js/navbar.js></script>
<script type=text/javascript src=/js/plyr.js></script>
<script type=text/javascript src=/js/main.js></script>
<script type=text/javascript>var sc_project=12797075,sc_invisible=1,sc_security="dff93a2a"</script><script type=text/javascript src=https://www.statcounter.com/counter/counter.js async></script><noscript><div class=statcounter><a title="Web Analytics
    Made Easy - Statcounter" href=https://statcounter.com/ target=_blank><img class=statcounter src=https://c.statcounter.com/12797075/0/dff93a2a/1/ alt="Web Analytics Made Easy - Statcounter" referrerpolicy=no-referrer-when-downgrade></a></div></noscript><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script>
<script src=/js/single.js></script>
<script>hljs.initHighlightingOnLoad()</script></body></html>